---
title: 'Inbox'
date: 2022-10-31
type: 'page'
---

# Inbox Methods

These methods are accessible via the `/inbox` URL.

## view_inbox ( session_id, [ options ] )

Displays a list of the messages in the empire's inbox. Displays 25 messages per page, sorted newest to oldest.

```json
{
  "messages": [
    {
      "id": "id-goes-here",
      "subject": "Vaxaslim",
      "date": "01 31 2010 13:09:05 +0600",
      "from": "Dr. Stephen T. Colbert DFA",
      "from_id": "id-goes-here",
      "to": "Jon Stewart",
      "to_id": "id-goes-here",
      "has_read": 1,
      "has_replied": 0,
      "body_preview": "Just a reminder that Vaxaslim ",
      "tags": "Correspondence"
    }
  ],
  "message_count": 14,
  "status": {
    /* ... */
  }
}
```

The `tags` section allows the user to filter the messages. You can do this either client side or server side. Available tags are:

- Tutorial

  Messages that come from the tutorial system.

- Correspondence

  Messages that are generated by other players, including the tutorial system.

- Medal

  Messages that let you know you've earned a medal.

- Intelligence

  Reports gathered from spies.

- Alert

  Messages letting you know something dire about your empire, usually sabotage by spies.

- Attack

  Messages informing you about attacks (offensive and defensive).

- Colonization

  Messages concerning staking and colonizing planets (including space station conversions).

- Complaint

  Messages regarding planetary complaints (happiness, resource, and pollution warnings).

- Excavator

  Messages about excavator findings (nothing, resources, glyph, plan).

- Mission

  Messages from the Mission Curators.

- Parliament

  Messages that tell you about Parliamentary proceedings (votes needed, votes passed, votes failed, etc).

- Probe

  Messages concerning detected probes.

- Spies

  Non-intelligence related spy reports.

- Trade

  Messages related to trades.

Throws 1002, 1006.

### session_id

A session id.

### options

A hash reference of extra options.

#### page_number

An integer representing which page of the inbox you'd like to view. Defaults to `1`.

#### tags

An array reference of tags. Only messages containing these tags will be displayed in the results.

#### empire

A name or ID of the baby empire to check the inbox of.

## view_archived ( session_id, [ options ])

Exactly the same as `view_inbox` except that it shows archived messages instead.

## view_trashed ( session_id, [ options ])

Exactly the same as `view_inbox` except that it shows trashed messages instead.

## view_sent ( session_id, [ options ] )

Exactly the same as `view_inbox` except that it shows sent messages instead.

## view_unread ( session_id, [ options ] )

Exactly the same as `view_inbox` except that it shows only the unread messages in the inbox.

## read_message ( session_id, message_id )

Retrieves a message. Marks it read if it hasn't been already.

```json
{
  "message": {
    "id": "id-goes-here",
    "from": "Dr. Stephen T. Colbert DFA",
    "from_id": "id-goes-here",
    "to": "Jon Stewart",
    "to_id": "id-goes-here",
    "subject": "Vaxaslim",
    "body": "Just a reminder that Vaxaslim may cause involuntary narnia adventures.",
    "date": "01 31 2010 13:09:05 +0600",
    "has_read": 1,
    "has_replied": 0,
    "has_archived": 0,
    "has_trashed": 0,
    "in_reply_to": "",
    "recipients": ["John Stewart"],
    "tags": ["Correspondence"],
    "attachments": {
      // no more than one of each type per email
      "image": {
        "url": "http://www.example.com/path/image.jpg",
        "title": "Some Title",
        "link": "http://www.lacunaexpanse.com/" // optional link to somewhere
      },
      "link": {
        "url": "http://www.lacunaexpanse.com/",
        "label": "The Lacuna Expanse Website"
      },
      "table": [
        ["Hostname", "IP Address"], // first row is always a header
        ["example.lacunaexpanse.com", "192.168.1.24"]
        /* ... */
      ],
      "map": {
        "surface": "surface-6",
        "buildings": [
          {
            "x": -3,
            "y": 4,
            "image": "apples4"
          }
          /* ... */
        ]
      }
    }
  },
  "status": {
    /* ... */
  }
}
```

`recipients` is the complete list of users who received the message, whereas `to` is the user that owns this particular copy of the message.

Throws 1002, 1006, 1010.

### session_id

A session id.

### message_id

A message*id that was returned using `view_inbox` or one of the other view* methods.

## archive_messages ( session_id, message_ids )

Archives a list of messages. Returns:

```json
{
  "success": ["id-goes-here", "id-goes-here"],
  "failure": ["id-goes-here", "id-goes-here"],
  "status": {
    /* ... */
  }
}
```

Archived messages are marked as read.

**NOTE:** You cannot archive sent messages. You'll get a failure if the message is either already archived, or it's a message that cannot be archived, like a message in your sent folder.

### session_id

A session id.

### message_ids

An array reference of message ids.

## trash_messages ( session_id, message_ids )

Trashed messages are marked as read.

Trashes a list of messages. Returns:

```json
{
  "success": ["id-goes-here", "id-goes-here"],
  "status": {
    /* ... */
  }
}
```

**NOTE:** You cannot trash messages sent to others. Only messages sent to you.

### session_id

A session id.

### message_ids

An array reference of message ids.

## trash*messages_where ( session_id, { spec => [ options, options, /* ... \_/ ] } )

Trashed messages are marked as read.

Trashes all messages matching the options. Returns:

```json
{
  "deleted": ["id-goes-here", "id-goes-here"],
  "deleted_count": 17340,
  "status": {
    /* ... */
  }
}
```

### session_id

A session id.

### named parameters

The named parameter list takes the following keys:

#### spec

A list of specifications for deletion. Each specification is another
object (hash). A message must match all keys provided to be deleted ("AND").
It is an error to specify no options. To delete all non-archived messages,
simply use `subject` of `%`.

Compounding multiple delete requests can be done by passing in additional
hash references.

Example:

```json
{ "tags": ["Attack", "Alert"], "subject": "BFG%" }
```

This will delete any message with either the `Attack` or `Alert` tags,
if the subject starts with _BFG_. Attack and alert messages that do not
start with "BFG" will not be deleted.

Keys are:

#### tags

An array reference of tags. Messages with any of these tags will be
eligible for deletion. Default is any and all tags (no tag evaluation).
Tags are given as a set, so are automatically "or"ed together.

#### subject

A subject line to match. Use `%` to represent zero or more characters
in that position, such as "Pass:%" to select all messages whose subject
starts with "Pass:". Default is essentially any subject (no subject
evaluation).

The subject may also be passed in as an array object, in which case it
is treated as tags above: a set to exactly match as a set of "or"ed values.

#### from

An array reference of from empire names. Full names are required.

#### return_ids

If this is present and set to a true value, all deleted message IDs will
be saved and returned. Gathering the IDs can, for large deletions, result
in extra server work, and also increase the size of the returned JSON
dramatically. This should only be set if you need the IDs for deleting from
an off-site message store, such as a local database, or an active message
view (UI).

If this is not set, the `deleted` key will not be returned at all.

The `deleted_count` key will still be present either way.

## send_message ( session_id, recipients, subject, body, [ options ] )

Sends a message to other players.

Throws 1002, 1005, 1006.

### session_id

A session id.

### recipients

A comma separated string of empire names. In addition to an empire name, `@ally` is available as a shortcut to send to all members of an alliance.

**NOTE:** You may want to expose a search option here using ["find" in Empire](/api/Empire#find).

### subject

A subject for the message. It cannot contain any special characters, and must be less than 100 characters in length, and cannot contain &, @, ;, <, or >.

### body

The body of the message. It cannot contain any special characters, and must be less than 200,000 characters in length, and cannot contain < or >.

### options

A hash reference of extra options.

#### in_reply_to

A message id. If this message is in reply to another message, then set this option to the message id of the original message.

#### forward

A message id. If this is set, then the attachments of the message id specified will be sent along with the new message.The text of the message will not automatically be forwarded, if that is desired, it is the client's responsibility to include it in the body of the new message.

# Message Formatting

The messages generated by the system have built in formatting commands to aid the user in figuring things out. These are items like displaying icons for UI consistency. Bolding important items, etc.

## Commands

These commands should be supported by all inbox clients. The commands are as follows.

### Bold

Bolds a segment of text by wrapping the text in asterisks.

```
    *bold*
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\*(\w.*?\w)\*/<b>$1<\/b>/xsg
```

### Food Icon

Represents an in game food resource icon.

```
    {food}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{food\}/<img>/xsg
```

### Water Icon

Represents an in game water resource icon.

```
    {water}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{water\}/<img>/xsg
```

### Ore Icon

Represents an in game ore resource icon.

```
    {ore}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{ore\}/<img>/xsg
```

### Energy Icon

Represents an in game energy resource icon.

```
    {energy}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{energy\}/<img>/xsg
```

### Waste Icon

Represents an in game waste resource icon.

```
    {waste}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{waste\}/<img>/xsg
```

### Happiness Icon

Represents an in game food resource icon.

```
    {happiness}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{happiness\}/<img>/xsg
```

### Time Icon

Represents an in game time icon that shows how long something will take.

```
    {time}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{time\}/<img>/xsg
```

### Build Icon

Represents an the in game build (tractor) icon.

```
   {build}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{build\}/<img>/xsg
```

### Essentia Icon

Represents an in game Essentia icon.

```
   {essentia}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{essentia\}/<img>/xsg
```

### Plots Icon

Represents an in game plots icon.

```
    {plots}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{plots\}/<img>/xsg
```

### URLs and Links

URLs are formatted using brackets rather than braces to make them stand out from all the other macros for icons and whatnot.

```
    [http://www.lacunaexpanse.com]
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/[((?:http|https):[a-z0-9\.\/\-_]+)]/<a href="$1">$1<\/a>/xisg
```

**NOTE:** It's very important that you exclude as many characters as possible from the URL so that there is less of a chance of a malicious attack from the formatted version. Therefore the link should only allow for `a-z 0-9 - _ . /`. It should not accept `% ? & :` or other funky formatting that could be used against the user. If it encounters that, it should ignore it rather than formatting it. In addition it should start with http:// or https://. All other protocols should be ignored.

### Empire Profile Link

The empire profile link is used by automated messages in the system to link users to the profile of an empire wherever that empire is mentioned in the text.

```
    {Empire 999 United Federation}
```

```
    {Empire id name}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{Empire\s(-*\d+)\s(.*?)\}/<a href="?empire_id=$1">$2<\/a>/xisg
```

**NOTE:** The link generated by this is of course bogus. It is only used as an example, your application would have to create whatever it needs to display the empire's profile which displayed the data from ["view_public_profile" in Empire](/api/Empire#view_public_profile).

### Star Map Link

Allows direct linking from emails to a location on the star map.

```
    {Starmap 432 -46 Earth}
```

```
    {Starmap x y name}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{Starmap\s(-*\d+)\s(\d+)\s(.*?)\}/<a href="?x=$1&y=$2">$3<\/a>/xisg
```

**NOTE:** The link generated by this is of course bogus. It is only used as an example, your application would have to create whatever it needs to display the location on the map.

### Planet Link

Allows direct linking to the surface view of a planet under the player's control.

```
    {Planet 99999 Earth}
```

```
    {Planet id name}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{Planet\s(-*\d+)\s(.*?)\}/<a href="?planet_id=$1">$2<\/a>/xisg
```

**NOTE:** The link generated by this is of course bogus. It is only used as an example, your application would have to create whatever it needs to display planet's surface.

### Alliance Link

Allows direct linking to an alliance profile.

```
    {Alliance 3393 Federation of Planets}
```

```
    {Alliance id name}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{Alliance\s(-*\d+)\s(.*?)\}/<a href="?alliance_id=$1">$2<\/a>/xisg
```

**NOTE:** The link generated by this is of course bogus. It is only used as an example, your application would have to create whatever it needs to display the alliance's profile which displayed the data from ["view_profile" in Alliance](/api/Alliance#view_profile).

### Parliament Vote

Allows a direct link to a vote in parliament, so that the alliance member need not actually go to the space station and then the parliament building, and then find the proper item to vote on.

```
    {VoteYes 393744 4948 9411}
```

```
    {VoteYes space_station_body_id parliament_id proposition_id}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{VoteYes\s(-*\d+)\s(-*\d+)\s(-*\d+)\}/<a href="/cast_vote?body_id=$1&building_id=$2&proposition_id=$3">Yes!<\/a>/xisg
```

```
    {VoteNo 393744 4948 9411}
```

```
    {VoteNo space_station_body_id parliament_id proposition_id}
```

Example Perl based regular expression for formatting it as HTML.

```perl
    s/\{VoteNo\s(-_\d+)\s(-_\d+)\s(-\*\d+)\}/<a href="/cast_vote?body_id=$1&building_id=$2&proposition_id=$3">No!<\/a>/xisg
```

**NOTE:** The links generated by this are of course bogus. It is only used as an example, your application would have to create whatever it needs to display the voting links that get posted to ["cast_vote" in Parliament](/api/Parliament#cast_vote).

## FAQ

- Why a domain specific language (DSL)?

  There's no way to build a rich text editor that would work across all the different platforms we support, but we need these formatting tools for our in-game messages, like the tutorial system. Users need an icon to go with the word, so we need to be able to inject that into the text message. In addition, our support people need to be able to send links to users to point them to wiki pages, forums, etc. And though they could just copy the link out of the message, some platforms require opening a separate browser app, so by using a DSL we can alert that client to the fact that this is a link that should open in a browser app.

- Why not just use HTML?

  To some extent the previous question should answer that. Beyond that though, let's enumerate all the reasons HTML sucks for this application.

  - Injection attacks are rampant on the internet. If we allow HTML to find its way into the mail system, no one is safe.
  - Not all platforms we intend to support will be able to render HTML.
  - How would do the `{Empire id name}` command in HTML? You need to be able to open a window in the app, which means you need to be able to call an API.
  - Which is easier to type:

```
<b>bold</b>
```

Or:

```
*bold*
```

Which do you think a user is more likely to get right and therefore be useful to them?

- How would you do `{food}` in HTML? Sure you can use an image tag, but what does it point to? Do you really want to download the icon from a public source in your iPhone app, when the iPhone app already has the icon locally? And if a user wanted to include the icon in their message, which is easier to type:

```
{food}
```

Or:

```
<img src="https://s3.amazonaws.com/us1.lacunaexpanse.com/assets/ui/s/food.png" alt="food" title="food">
```

In short, HTML is long, tedious, ugly, vulnerable, and a terrible language for the types of applications we have in Lacuna.
